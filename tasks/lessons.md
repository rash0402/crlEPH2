# EPH v2.1 — Lessons Learned

## Phase 1-3 教訓

### 境界条件の重要性
- θ方向: 周期境界 (wrap_index) — 角度は連続
- r方向: Neumann境界 (zero gradient) — 距離は有限
- 境界条件のバグは発見困難。テストで必ずエッジケースを検証すること

### Eigen使用上の注意
- `.eval()` を使ってstop-gradient効果を得る（Hazeの微分防止）
- `.noalias()` で不要なコピーを削減
- Matrix12x12はスタック割り当て（十分小さい）

## Phase 4 教訓

### パラメータチューニング
- LEARNING_RATE: 非線形応答あり。LR≈0.7で傾きが変化
- 補間探索で実験コスト60%削減 (10試行→4試行)
- 平衡化時間は緩和時間の20倍以上必要 (τ≈10, 最低200ステップ)

### 対称性破壊の必要性
- ランダム初速度 [0.3, 1.0] m/s が必須
- 全エージェント同一初期条件 → φ=0 に崩壊
- 対称性が破れないと相転移が観測不可能

### 能動的推論の相転移の特異性
- χ(β)最大がβ=0（完全独立）に出現 ← 古典的相転移と異なる
- β_c付近ではなくβ=0で最大多様性
- これは計算ミスではなく物理的に正しい発見

### Two-stage更新の重要性
- MB破れは「全エージェントの近傍平均を先に計算→一括適用」
- 逐次更新だと結果が更新順序に依存（非物理的）
- 必ず2ステージ（compute → apply）で実装

### テストタイムアウト
- β掃引テストは計算コストが高い（β×ステップ数）
- ctestのデフォルトタイムアウト(120s)では不足する場合がある
- `set_tests_properties(test PROPERTIES TIMEOUT 300)` で個別設定

---

*Created: 2026-02-06*
*Updated: 2026-02-06*
